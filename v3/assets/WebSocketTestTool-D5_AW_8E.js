import{f as A,l as b,r as G,_ as V,A as j,m as q,aA as K,D as Z,x as f,n as m,q as a,w as n,p as l,b0 as I,aK as d,aZ as c,a$ as L,aN as v,o as W,b6 as Q,F as M,y as B,t as $,z as X,aI as D,b2 as Y,aG as ee}from"./index-BKvL4bCX.js";import{g as te}from"./getCommonDateTime-9O9gLM5u.js";import{a as se,s as le,N as E}from"./RadioGroup-BdLTXmmq.js";import{N as R}from"./Form-mPnyzTSO.js";import{N as g}from"./FormItem-DCbrlobA.js";import{N as ae}from"./InputGroup-Ce5llk5n.js";import{d as ne,g as oe}from"./Select-y25Hn_WI.js";import{N as F}from"./Input-CylcvuRs.js";import{N as re}from"./Flex-C-gYDqtT.js";import{N as H}from"./InputNumber-BVO98d2U.js";import"./use-merged-state-CKbFJlkG.js";import"./get-slot-Bk_rJcZu.js";import"./get-CQG32wRx.js";import"./Popover-BG5MQIM7.js";import"./Follower-L5kM5qp8.js";const y=A({name:"RadioButton",props:se,setup:le,render(){const{mergedClsPrefix:i}=this;return b("label",{class:["".concat(i,"-radio-button"),this.mergedDisabled&&"".concat(i,"-radio-button--disabled"),this.renderSafeChecked&&"".concat(i,"-radio-button--checked"),this.focus&&["".concat(i,"-radio-button--focus")]]},b("input",{ref:"inputRef",type:"radio",class:"".concat(i,"-radio-input"),value:this.value,name:this.mergedName,checked:this.renderSafeChecked,disabled:this.mergedDisabled,onChange:this.handleRadioInputChange,onFocus:this.handleRadioInputFocus,onBlur:this.handleRadioInputBlur}),b("div",{class:"".concat(i,"-radio-button__state-border")}),G(this.$slots.default,t=>!t&&!this.label?null:b("div",{ref:"labelRef",class:"".concat(i,"-radio__label")},t||this.label)))}}),ie={class:"tool-detail-page"},ue={class:"message-list"},de=["innerHTML"],pe={key:1,class:"message-content"},fe={__name:"WebSocketTestTool",setup(i){const t=j({address:{prefix:"ws://",suffix:""},autoScroll:!0,inputs:"",logsHeight:320,logsMax:100,messages:[],messageID:0,parseType:"string",parseTypes:[{name:"html",label:"HTML"},{name:"json",label:"JSON"},{name:"string",label:"字符串"}],ws:null}),x=q(null);function z(){D.create({content:"确定要清空输入的内容吗？",negativeText:"取消",positiveText:"确定",title:"确认",type:"default",onPositiveClick:()=>{t.inputs=""}})}function U(){D.create({content:"确定要清空消息内容吗？",negativeText:"取消",positiveText:"确定",title:"确认",type:"default",onPositiveClick:()=>{t.messages=[],t.messageID=0}})}function S(o){let e=o.target;p({message:"WebSocket 已关闭",type:"warning"}),e&&(e.removeEventListener("close",S),e.removeEventListener("error",w),e.removeEventListener("message",k),e.removeEventListener("open",N))}function w(){p({message:"WebSocket 发生错误",type:"error"})}function k(o){let e=o.data,s=x.value;if(!e)return;let r=h(!1,e);console.log("%c%s","color: #2196F3;","[接收]",r||(r||e)),T("receive",e),ee(()=>{s&&t.autoScroll&&s.scrollTo(0,s.scrollHeight)})}function N(){p({message:"WebSocket 已连接",type:"info"})}function P(){typeof WebSocket>"u"&&p({duration:0,message:"您的浏览器不支持 WebSocket。",title:"错误",type:"error"})}function p(o){let{duration:e=3e3,message:s="",title:r="提示",type:u="info"}=o;return Y.create({content:s,duration:e,title:r,type:u})}function T(o,e=""){if(["receive","send"].indexOf(o)===-1)return;let r=t.messages.length,u=t.logsMax;r>=u&&t.messages.splice(0,r-u+1),t.messageID+=1,t.messages.push({id:t.messageID,message:e,time:Date.now(),type:o})}function C(){t.ws&&(t.ws.close(),t.ws=null)}function O(){let o=t.address,e=o.prefix+o.suffix;if(!o.suffix){p({message:"请填写连接地址",title:"连接失败",type:"warning"});return}try{let s=new WebSocket(e);s.addEventListener("close",S),s.addEventListener("error",w),s.addEventListener("message",k),s.addEventListener("open",N),t.ws=s}catch(s){p({message:String(s),title:"连接失败",type:"error"})}}function h(o=!1,e=""){if(t.parseType==="json")try{return JSON.parse(e)}catch(r){let u=o?"解析发送的 JSON 消息失败":"解析接收的 JSON 消息失败",_=String(r);return console.warn(u),console.warn(_),p({message:_,title:u,type:"warning"}),null}else return e}function J(){let o=t.ws,e=t.inputs.replace(/(\n|\r)/g,""),s=h(!0,e);o&&s&&(console.log("%c%s","color: #4CAF50;","[发送]",s),o.send(e),T("send",e))}return K(()=>{P()}),Z(()=>{C()}),(o,e)=>(f(),m("div",ie,[a(l(c),{size:"small",title:"注意"},{default:n(()=>[a(l(I),null,{default:n(()=>e[9]||(e[9]=[d("由于浏览器限制，通过 HTTPS 访问网站时只能连接带 SSL 的 WebSocket（WSS）。")])),_:1}),a(l(I),null,{default:n(()=>e[10]||(e[10]=[d("若需要连接不带 SSL 的 WebSocket（WS），建议下载到本地后使用。")])),_:1})]),_:1}),a(l(c),{size:"small",title:"输入"},{default:n(()=>[a(l(R),{class:"form-no-feedback","label-align":"left","label-placement":"top","label-width":"auto",onContextmenu:e[3]||(e[3]=L(()=>{},["stop"]))},{default:n(()=>[a(l(g),{label:"连接地址"},{default:n(()=>[a(l(ae),{class:"address-input"},{default:n(()=>[a(l(ne),{value:t.address.prefix,"onUpdate:value":e[0]||(e[0]=s=>t.address.prefix=s),options:[{label:"ws://",value:"ws://"},{label:"wss://",value:"wss://"}]},null,8,["value"]),a(l(F),{value:t.address.suffix,"onUpdate:value":e[1]||(e[1]=s=>t.address.suffix=s),type:"text"},null,8,["value"])]),_:1})]),_:1}),a(l(g),{label:"发送内容（自动移除换行符）"},{default:n(()=>[a(l(F),{value:t.inputs,"onUpdate:value":e[2]||(e[2]=s=>t.inputs=s),placeholder:"在此处输入要发送的内容",type:"textarea",rows:2},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(l(c),{size:"small",title:"操作"},{default:n(()=>[a(l(re),null,{default:n(()=>[a(l(v),{type:"success",disabled:t.ws!==null,onClick:O},{default:n(()=>e[11]||(e[11]=[d("连接")])),_:1},8,["disabled"]),a(l(v),{type:"warning",disabled:t.ws===null,onClick:C},{default:n(()=>e[12]||(e[12]=[d("断开")])),_:1},8,["disabled"]),a(l(v),{type:"primary",disabled:t.ws===null,onClick:J},{default:n(()=>e[13]||(e[13]=[d("发送")])),_:1},8,["disabled"]),a(l(v),{type:"error",onClick:z},{default:n(()=>e[14]||(e[14]=[d("清空输入")])),_:1}),a(l(v),{type:"error",onClick:U},{default:n(()=>e[15]||(e[15]=[d("清空消息")])),_:1})]),_:1})]),_:1}),a(l(c),{size:"small",title:"日志"},{default:n(()=>[W("div",{ref_key:"logsContentRef",ref:x,class:"logs-content",style:Q({height:t.logsHeight+"px"}),onContextmenu:e[4]||(e[4]=L(()=>{},["stop"]))},[W("div",ue,[(f(!0),m(M,null,B(t.messages,s=>(f(),m("div",{key:s.id,class:"message-item"},[a(l(oe),{type:s.type==="send"?"primary":"success",size:"small"},{default:n(()=>[d($(l(te)(s.time)),1)]),_:2},1032,["type"]),t.parseType==="html"?(f(),m("div",{key:0,innerHTML:s.message,class:"message-content"},null,8,de)):(f(),m("div",pe,$(s.message),1))]))),128))])],36)]),_:1}),a(l(c),{size:"small",title:"设置"},{default:n(()=>[a(l(R),{class:"form-no-feedback","label-align":"left","label-placement":"top","label-width":"auto"},{default:n(()=>[a(l(g),{label:"日志高度"},{default:n(()=>[a(l(H),{value:t.logsHeight,"onUpdate:value":e[5]||(e[5]=s=>t.logsHeight=s),min:80,max:800,precision:0,step:1},null,8,["value"])]),_:1}),a(l(g),{label:"日志最大行数"},{default:n(()=>[a(l(H),{value:t.logsMax,"onUpdate:value":e[6]||(e[6]=s=>t.logsMax=s),min:1,max:8192,precision:0,step:1},null,8,["value"])]),_:1}),a(l(g),{label:"解析类型"},{default:n(()=>[a(l(E),{value:t.parseType,"onUpdate:value":e[7]||(e[7]=s=>t.parseType=s)},{default:n(()=>[(f(!0),m(M,null,B(t.parseTypes,s=>(f(),X(l(y),{key:s.name,label:s.label,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["value"])]),_:1}),a(l(g),{label:"自动滚动"},{default:n(()=>[a(l(E),{value:t.autoScroll,"onUpdate:value":e[8]||(e[8]=s=>t.autoScroll=s)},{default:n(()=>[a(l(y),{label:"开启",value:!0}),a(l(y),{label:"关闭",value:!1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]))}},Ie=V(fe,[["__scopeId","data-v-7e6f080b"]]);export{Ie as default};
