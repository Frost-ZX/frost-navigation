System.register(["./index-legacy-DtdHQVf4.js","./getCommonDateTime-legacy-DiLPap3O.js","./index-legacy-CutgehBt.js","./Select-legacy-D__twIEj.js","./Flex-legacy-Yyv4fGRB.js","./InputNumber-legacy-DkyliKFP.js","./Popover-legacy---2d6L80.js","./get-legacy-DX4lm7ue.js","./Follower-legacy-CXIJcsoN.js","./use-merged-state-legacy-CAoj7XEw.js","./Input-legacy-BYW6Nb2d.js","./get-slot-legacy-BK898JfD.js"],(function(e,t){"use strict";var a,i,l,s,r,n,o,d,c,u,f,h,p,y,m,g,_,v,x,w,b,F,R,T,C,k,j,z,L,I;return{setters:[e=>{a=e._,i=e.m,l=e.A,s=e.g,r=e.C,n=e.D,o=e.x,d=e.n,c=e.q,u=e.w,f=e.p,h=e.b0,p=e.aK,y=e.aZ,m=e.o,g=e.aN,_=e.t,v=e.a$,x=e.F,w=e.y,b=e.aX,F=e.b5,R=e.$,T=e.aG},e=>{C=e.g},e=>{k=e.b},e=>{j=e.d,z=e.g},e=>{L=e.N},e=>{I=e.N},null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".config-item[data-v-8fa9d147],.config-item .config-item__content[data-v-8fa9d147]{display:flex;align-items:center}.config-item .n-input-number[data-v-8fa9d147],.config-item .n-select[data-v-8fa9d147]{width:128px}.chat-history[data-v-8fa9d147]{position:relative;background-color:#fff}.chat-history.chat-history--is-full[data-v-8fa9d147]{position:fixed;left:0;top:0;margin-top:0!important;width:100%;height:100%}.chat-history.chat-history--is-full .chat-history__wrapper[data-v-8fa9d147],.chat-history.chat-history--is-full .chat-history__list[data-v-8fa9d147]{height:100%}.chat-history .chat-history__toggle-full[data-v-8fa9d147]{cursor:pointer}.chat-history .chat-history__wrapper[data-v-8fa9d147]{--line-margin: 8px;padding:16px;border:1px solid #F0F0F0;border-radius:4px;font-family:monospace;line-height:calc(1em + var(--line-margin));word-break:break-all}.chat-history .chat-history__list[data-v-8fa9d147]{height:320px;overflow-y:auto}.chat-history .chat-history__item[data-v-8fa9d147]{display:flex;margin:var(--line-margin) 0}.chat-history .chat-history__item[data-v-8fa9d147]:first-child{margin-top:0}.chat-history .chat-history__item[data-v-8fa9d147]:last-child{margin-bottom:0}.chat-history .chat-history__time[data-v-8fa9d147]{margin:auto .5em auto 0}.chat-history .chat-history__text[data-v-8fa9d147]{margin:auto 0;user-select:text;white-space:pre-wrap}\n/*$vite$:1*/",document.head.appendChild(t);const N={class:"tool-detail-page"},M={class:"config-item"},S={class:"config-item__content"},B={class:"config-item"},E={class:"config-item__content"},$={key:0,class:"mdi mdi-arrow-collapse"},A={key:1,class:"mdi mdi-arrow-expand"},O={class:"chat-history__text"};e("default",a({__name:"ChatHistoryReader",setup(e){const t=/\[CHAT\]\s+(.*)$/,a=/\[(\d{2}:\d{2}:\d{2})\]/,{data:D,fileLastModified:H,fileName:V,fileSize:K,isSupported:U,open:G,updateData:q}=k({dataType:"ArrayBuffer",excludeAcceptAllOption:!0,types:[{accept:{"text/plain":[".log"]},description:"Minecraft 日志文件"}]}),J=i(null),P=l({isFullView:!1,isReadingFile:!1,isOpenedFile:!1,lastFileSize:0,LastModifiedTime:0,lastReadLineNumber:0,readInterval:2,readTimer:null,textEncoding:"utf-8",textRows:[]}),X=s((()=>{let e=K.value;return e?`${(e/1024).toFixed(2)} KB`:"-"})),Z=s((()=>{let e=H.value;return e?C(e,"all"):"-"}));function Q(){P.textRows=[]}function W(e=!1){P.lastFileSize=0,P.LastModifiedTime=0,P.lastReadLineNumber=0,P.textRows=e?[{id:F(),type:"chat",time:C(null,"time"),text:"请点击按钮选择日志文件以开始。"}]:[]}async function Y(e=!1){e&&await q();let i=K.value,l=H.value,s=D.value,r="",n=P.lastReadLineNumber,o=[],d=[];return l!==P.LastModifiedTime&&(P.LastModifiedTime=l,s instanceof ArrayBuffer&&(r=function(e=null){try{return new TextDecoder(P.textEncoding).decode(e)}catch(t){return console.error("解码失败："),console.error(t),""}}(s)),r?(o=r.split("\n").map((e=>e.replace(/\r$/,""))).filter((e=>Boolean(e))),i<P.lastFileSize&&(n=0),o.splice(0,n),n+=o.length,o.forEach((e=>{let i=function(e=""){try{let i=e.match(t),l=i?i[1]:"",s=e.match(a),r=s?s[1]:"";if(l)return l=l.replace(/\\n/g,"\n").replace(/§\w/g,""),{id:F(),type:"chat",time:r,text:l}}catch(i){console.error("解析内容失败："),console.error(i)}return{id:null,type:"",time:"",text:""}}(e);"chat"===i.type&&d.push(i)})),P.lastFileSize=i,P.lastReadLineNumber=n,P.textRows.push.apply(P.textRows,d),function(){let e=J.value;if(!e)return void console.error("自动滚动失败：元素不存在");let t=e.getBoundingClientRect(),a=Math.round(t.height),i=e.scrollHeight,l=0;i-e.scrollTop===a&&T((()=>{l=e.scrollHeight,l>a&&e.scrollTo({behavior:"instant",top:l-a})}))}(),!0):(console.warn("文件内容为空或解码失败"),!1))}async function ee(){if(!U.value)return R.error("当前浏览器不支持该功能"),!1;try{return await G(),R.success("打开文件成功"),P.isOpenedFile=!0,W(!1),Y(!1),te(!0),!0}catch(e){return console.error("打开文件失败："),console.error(e),R.error("打开文件失败"),!1}}function te(e=!1){if(P.readTimer&&clearInterval(P.readTimer),!e)return P.isReadingFile=!1,void(P.readTimer=null);P.isReadingFile=!0,P.readTimer=setInterval((()=>{Y(!0)}),1e3*P.readInterval)}return r((()=>{W(!0)})),n((()=>{te(!1)})),(e,t)=>(o(),d("div",N,[c(f(y),{size:"small",title:"说明"},{default:u((()=>[c(f(h),null,{default:u((()=>t[7]||(t[7]=[p("已测试游戏版本：1.12.2 ~ 1.21.4")]))),_:1}),c(f(h),null,{default:u((()=>t[8]||(t[8]=[p("若内容出现乱码，请尝试更改“文件编码”后重新打开文件。")]))),_:1})])),_:1}),c(f(y),{size:"small",title:"设置"},{default:u((()=>[c(f(L),null,{default:u((()=>[m("div",M,[t[9]||(t[9]=m("div",{class:"config-item__label"},"文件编码：",-1)),m("div",S,[c(f(j),{value:P.textEncoding,"onUpdate:value":t[0]||(t[0]=e=>P.textEncoding=e),options:[{label:"GBK",value:"gbk"},{label:"UTF-8",value:"utf-8"}]},null,8,["value"])])]),m("div",B,[t[11]||(t[11]=m("div",{class:"config-item__label"},"读取间隔：",-1)),m("div",E,[c(f(I),{value:P.readInterval,"onUpdate:value":t[1]||(t[1]=e=>P.readInterval=e),disabled:P.isReadingFile,min:1,max:60,precision:0,step:1},null,8,["value","disabled"]),t[10]||(t[10]=m("span",{style:{"margin-left":"0.5em"}},"秒",-1))])])])),_:1})])),_:1}),c(f(y),{size:"small",title:"操作"},{default:u((()=>[c(f(L),{class:"action-row"},{default:u((()=>[c(f(g),{type:"success",onClick:ee},{default:u((()=>t[12]||(t[12]=[p("选择文件")]))),_:1}),c(f(g),{type:"primary",disabled:!P.isOpenedFile,onClick:t[2]||(t[2]=e=>Y(!0))},{default:u((()=>t[13]||(t[13]=[p("刷新内容")]))),_:1},8,["disabled"]),c(f(g),{type:"primary",disabled:!P.isOpenedFile||P.isReadingFile,onClick:t[3]||(t[3]=e=>te(!0))},{default:u((()=>t[14]||(t[14]=[p("开始读取")]))),_:1},8,["disabled"]),c(f(g),{type:"error",disabled:!P.isOpenedFile||!P.isReadingFile,onClick:t[4]||(t[4]=e=>te(!1))},{default:u((()=>t[15]||(t[15]=[p("停止读取")]))),_:1},8,["disabled"]),c(f(g),{type:"error",onClick:Q},{default:u((()=>t[16]||(t[16]=[p("清空内容")]))),_:1})])),_:1})])),_:1}),c(f(y),{size:"small",title:"信息"},{default:u((()=>[c(f(L),null,{default:u((()=>[c(f(z),{type:"info"},{default:u((()=>[p("文件名称："+_(f(V)||"-"),1)])),_:1}),c(f(z),{type:"info"},{default:u((()=>[p("文件大小："+_(X.value),1)])),_:1}),c(f(z),{type:"info"},{default:u((()=>[p("修改时间："+_(Z.value),1)])),_:1})])),_:1})])),_:1}),c(f(y),{size:"small",title:"内容",class:b({"chat-history":!0,"chat-history--is-full":P.isFullView})},{"header-extra":u((()=>[m("div",{class:"chat-history__toggle-full",onClick:t[5]||(t[5]=e=>P.isFullView=!P.isFullView)},[P.isFullView?(o(),d("span",$)):(o(),d("span",A))])])),default:u((()=>[m("div",{class:"chat-history__wrapper",onContextmenu:t[6]||(t[6]=v((()=>{}),["stop"]))},[m("div",{ref_key:"chatHistoryListRef",ref:J,class:"chat-history__list"},[(o(!0),d(x,null,w(P.textRows,(e=>(o(),d("div",{key:e.id,class:"chat-history__item"},[c(f(z),{class:"chat-history__time",size:"small",type:"info"},{default:u((()=>[p(_(e.time),1)])),_:2},1024),m("div",O,_(e.text),1)])))),128))],512)],32)])),_:1},8,["class"])]))}},[["__scopeId","data-v-8fa9d147"]]))}}}));
